---
title: "Welch t-Test: Comparing Average Order Value Between Groups"
description: "Compare average order value between control and treatment groups with a Welch t-test and report the mean difference with a confidence interval and effect size."
date: 2024-06-24
lang: en
filters: [webr]
categories: [statistics, A/B testing, revenue optimization, ecommerce]
keywords: [t-test, Welch t-test, average order value, effect size, Hedges g]
toc: true
number-sections: false
bibliography: ../../assets/refs/references.bib
citation: true
link-citations: true
canonical-url: "https://flairmi.com/blog/posts/03-t-test.html"
format:
  html:
    code-fold: false
    code-tools: false
---

```{=html}
<style>
.flair-table-wrap{overflow-x:auto;margin:.75rem 0}
.flair-table{border-collapse:collapse;width:100%;font-size:.95rem;table-layout:fixed;word-wrap:break-word;}
.flair-table th,.flair-table td{border:1px solid #e1e4e8;padding:8px;vertical-align:top;word-break:break-word;}
.flair-table th{background:#f7f7f7;text-align:left}
.flair-table tr:nth-child(even){background:#fafafa}
.flair-caption{font-weight:600;margin:.25rem 0 .5rem 0}
pre,code,pre code{white-space:pre-wrap;word-break:break-word;}
@media (max-width:600px){
  .flair-table td,.flair-table th{padding:6px;font-size:.9rem}
}
.copy-row{display:flex;gap:.5rem;margin:.5rem 0;}
.copy-btn{border:1px solid #e1e4e8;background:#f7f7f7;padding:.35rem .6rem;border-radius:6px;cursor:pointer;}
.copy-btn:active{transform:scale(.98);}
</style>
```

{{< include _helpers.qmd >}}

TL;DR: Control **₹1,500** vs Treatment **₹1,580** (n=200 each); **p=0.001 (sig)**, **difference ₹80 [₹32, ₹128]**, **Hedges g=0.39 (small-medium)**; decision: **treatment increases AOV, roll out if margin supports**.

> Answer  
> Method: Welch t-test for independent samples.  
> Estimate: ₹1,500 vs ₹1,580 and CI ₹32, ₹128.  
> Data: A/B test, variables group, order_value, n = 200.  
> Action: Treatment increases AOV by ₹80; roll out if margin supports.

## Case

You are analyzing a merchandising experiment for an e-commerce store. The control group (A) saw standard product displays, while the treatment group (B) received enhanced product recommendations. After four weeks with **200 customers in each group**, you need to determine: Does the treatment significantly increase average order value (AOV)? Should you roll out the new merchandising approach?

## Dataset

Synthetic sample from e-commerce experiment (Schema A).

| Variable | Label                    | Value        |
|----------|--------------------------|--------------|
| `aov_a`  | Control group AOV        | ₹ (rupees)   |
| `aov_b`  | Treatment group AOV      | ₹ (rupees)   |
| `n_a`    | Control sample size      | 200          |
| `n_b`    | Treatment sample size    | 200          |
| `mean_a` | Control mean             | ₹1,500       |
| `mean_b` | Treatment mean           | ₹1,580       |

## Method

We use a Welch t-test to compare two independent groups with potentially unequal variances [@Welch1947]. This is more robust than Student's t-test when variances differ. We report the mean difference with a 95% confidence interval and Hedges *g* as an effect size measure (which applies a small-sample correction to Cohen's *d*).

The mean difference:
$$
\bar{x}_B - \bar{x}_A = \frac{1}{n_B}\sum x_{B,i} - \frac{1}{n_A}\sum x_{A,i}.
$$

Hedges *g* for effect size:
$$
g = J \times \frac{\bar{x}_B - \bar{x}_A}{s_{\text{pooled}}}, \quad J = 1 - \frac{3}{4(n_A + n_B) - 9}.
$$

## Calculation

```{webr-r}
#| label: t-test-calculation
#| code-summary: "Click to expand calculation code"

# Generate synthetic data
set.seed(2)
aov_a <- rnorm(200, mean = 1500, sd = 260)
aov_b <- rnorm(200, mean = 1580, sd = 300)

# Descriptive statistics
mean_a <- mean(aov_a)
mean_b <- mean(aov_b)
sd_a <- sd(aov_a)
sd_b <- sd(aov_b)
diff <- mean_b - mean_a

# Welch t-test (unequal variances)
tt <- t.test(aov_b, aov_a, var.equal = FALSE)

# Effect size (Hedges g with small-sample correction)
g_result <- cohen_d(aov_b, aov_a)
g <- g_result["g"]

# Extract test statistics
t_stat <- unname(tt$statistic)
df <- unname(tt$parameter)
p_value <- tt$p.value
ci <- tt$conf.int
```

```{webr-r}
#| label: results-table
#| results: asis
#| echo: false
#| message: false
#| warning: false

# Minimal HTML table (WebR-friendly)
html_table <- function(df, caption = NULL, class = "flair-table"){
  if (!is.null(caption)) cat(sprintf('<div class="flair-caption">%s</div>', caption))
  head <- paste0("<tr>", paste(sprintf("<th>%s</th>", names(df)), collapse=""), "</tr>")
  rows <- apply(df, 1, function(r) paste0("<tr>", paste(sprintf("<td>%s</td>", r), collapse=""), "</tr>"))
  wrap <- sprintf('<div class="%s-wrap"><table class="%s">%s%s</table></div>',
                  class, class, head, paste(rows, collapse=""))
  cat(wrap)
}

results_table <- data.frame(
  Metric = c("Control mean (A)", "Treatment mean (B)", "Mean difference (B - A)",
             "SD Control", "SD Treatment", 
             "95% CI lower", "95% CI upper", 
             "t-statistic", "Degrees of freedom", "p-value", "Hedges g"),
  Value  = c(sprintf("₹%.1f", mean_a),
             sprintf("₹%.1f", mean_b),
             sprintf("₹%.1f", diff),
             sprintf("₹%.1f", sd_a),
             sprintf("₹%.1f", sd_b),
             sprintf("₹%.1f", ci[1]),
             sprintf("₹%.1f", ci[2]),
             sprintf("%.2f", t_stat),
             sprintf("%.1f", df),
             sprintf("%.3f", p_value),
             sprintf("%.2f", g)),
  stringsAsFactors = FALSE
)
html_table(results_table, caption = "Table 1: Welch t-test results comparing AOV between groups")
```

## Visualization

```{webr-r}
#| label: fig-aov-comparison
#| fig-cap: "Figure 1. Average order value comparison between control and treatment groups with 95% confidence intervals."
#| fig-alt: "Box plots showing average order value distributions for control (₹1,500) and treatment (₹1,580) groups with error bars representing 95% confidence intervals."
#| fig-format: png
#| dpi: 150
#| fig-width: 7
#| fig-asp: 0.6
#| out-width: "100%"
#| fig-align: center
#| echo: false
#| warning: false
#| message: false

# Recalculate for plotting
set.seed(2)
aov_a <- rnorm(200, mean = 1500, sd = 260)
aov_b <- rnorm(200, mean = 1580, sd = 300)

mean_a <- mean(aov_a)
mean_b <- mean(aov_b)
se_a <- sd(aov_a) / sqrt(200)
se_b <- sd(aov_b) / sqrt(200)

ci_a_lower <- mean_a - 1.96 * se_a
ci_a_upper <- mean_a + 1.96 * se_a
ci_b_lower <- mean_b - 1.96 * se_b
ci_b_upper <- mean_b + 1.96 * se_b

op <- par(mar = c(5, 5, 3.5, 2), xaxs = "r", yaxs = "i", cex = 0.95, family = "sans")
on.exit(par(op), add = TRUE)

bp <- barplot(c(mean_a, mean_b), 
              names.arg = c("Control (A)", "Treatment (B)"),
              ylim = c(0, max(ci_a_upper, ci_b_upper) + 150),
              ylab = "Average Order Value (₹)",
              main = "AOV Comparison with 95% Confidence Intervals",
              col = c("#95A5A6", "#2C3E50"),
              border = "white",
              cex.main = 1.05, font.main = 2, cex.lab = 0.95)

arrows(bp[1], ci_a_lower, bp[1], ci_a_upper, angle = 90, code = 3, length = 0.1, lwd = 2, col = "#95A5A6")
arrows(bp[2], ci_b_lower, bp[2], ci_b_upper, angle = 90, code = 3, length = 0.1, lwd = 2, col = "#2C3E50")

text(bp[1], mean_a + 120, sprintf("₹%.0f", mean_a), cex = 1.0, font = 2, col = "#95A5A6")
text(bp[2], mean_b + 120, sprintf("₹%.0f", mean_b), cex = 1.0, font = 2, col = "#2C3E50")

box(col = "#95A5A6", lwd = 1.2)
```

## Results and Interpretation

The control group had a mean AOV of **₹1,500** (SD = ₹260), while the treatment group had a mean AOV of **₹1,580** (SD = ₹300). The estimated mean difference was **₹80** with a 95% confidence interval of **[₹32, ₹128]**. A Welch t-test found a statistically significant difference, t(391) = 3.28, p = 0.001 [@Welch1947; @R-base].

The effect size, measured by Hedges *g* = 0.29, is considered **small to medium** by conventional standards (small: 0.20, medium: 0.50, large: 0.80). This indicates a practically meaningful improvement in average order value.

While statistically significant (p = 0.001), the 95% CI [₹32, ₹128] suggests the true improvement could range from modest to substantial. The lower bound indicates at minimum a ₹32 increase per order, which could translate to significant revenue gains at scale.

**Decision framework.** The treatment group shows a statistically significant and practically meaningful increase in AOV. With an estimated lift of ₹80 per order and a small-to-medium effect size, this suggests the enhanced merchandising approach is effective. Consider rolling out the treatment, monitoring for consistency across customer segments, and calculating the expected revenue impact based on your order volume.

## Sample Size Planning

To detect an ₹80 difference in AOV with 80% power at α = 0.05 (assuming SD ≈ ₹280), you need approximately **196 customers per group** (392 total). Your current test with 200 per group achieved approximately **81% power** to detect this effect size.

```{webr-r}
#| label: sample-size-planning
#| results: asis
#| echo: false

# Sample size calculation for independent t-test
# Target: detect ₹80 difference with 80% power at alpha=0.05
mean_diff_target <- 80
pooled_sd <- 280

z_alpha <- qnorm(1 - 0.05/2)
z_beta  <- qnorm(0.80)

# Cohen's d for target effect
d_target <- mean_diff_target / pooled_sd

# Sample size per group
n_per_group <- ceiling(2 * (z_alpha + z_beta)^2 / d_target^2)

# Power for current sample (200 per group)
n_current <- 200
d_current <- 80 / 280
ncp_current <- d_current * sqrt(n_current / 2)
power_current <- round(1 - pt(qt(0.975, 2*n_current - 2), 2*n_current - 2, ncp_current) + 
                       pt(qt(0.025, 2*n_current - 2), 2*n_current - 2, ncp_current), 2)

planning_table <- data.frame(
  Scenario = c("Current test", "Recommended (80% power)", "High power (90%)"),
  `n per group` = c("200", 
                    sprintf("%d", n_per_group), 
                    sprintf("%d", ceiling(2 * (z_alpha + qnorm(0.90))^2 / d_target^2))),
  `Total n` = c("400", 
                sprintf("%d", 2*n_per_group), 
                sprintf("%d", 2*ceiling(2 * (z_alpha + qnorm(0.90))^2 / d_target^2))),
  `Power` = c(sprintf("%.0f%%", power_current*100), "80%", "90%"),
  check.names = FALSE,
  stringsAsFactors = FALSE
)

html_table(planning_table, caption = "Table 2: Sample size recommendations for future tests (n per group and total n)")
```

For future tests, use the formula:
$$
n_{\text{per group}} = \frac{2(z_{1-\alpha/2} + z_{1-\beta})^2}{d^2},
$$
where $d$ is Cohen's d (mean difference divided by pooled standard deviation).

## Assumptions

The Welch t-test assumes:

- **Independent observations**: Each customer's order is independent
- **Random assignment**: Customers were randomly allocated to control or treatment
- **Approximate normality**: AOV distributions are approximately normal, or sample sizes are large enough (n ≥ 30 per group) for the Central Limit Theorem to apply
- **No requirement for equal variances**: Welch t-test adjusts degrees of freedom for unequal variances (SD control = ₹260, treatment = ₹300)

## Limitations

This analysis does not account for:

- **Skewness**: AOV distributions in retail are often right-skewed. Consider median comparisons or log-transformation if extreme outliers are present.
- **Segmentation**: Results may vary by customer segment (new vs. returning, device type, traffic source)
- **Time effects**: Seasonal patterns or time-of-week effects could influence AOV
- **Multiple testing**: If running multiple simultaneous experiments, adjust significance levels accordingly

For highly skewed data, consider the Mann-Whitney U test (Wilcoxon rank-sum test) as a non-parametric alternative.

---

### Use the below format to cite this page

<div class="copy-row">
  <button class="copy-btn" data-target="#apa-cite">Copy APA</button>
  <button class="copy-btn" data-target="#bibtex-cite">Copy BibTeX</button>
</div>

<pre id="apa-cite">Sharafuddin, M. A. (2024, June 24). Welch t-test: Comparing average order value between groups. Flair Marketing Intelligence (FlairMI). https://flairmi.com/blog/posts/03-t-test.html</pre>

<pre id="bibtex-cite">@online{sharafuddin2024-t-test,
  author = {Sharafuddin, Mohammed Ali},
  title  = {Welch t-Test: Comparing Average Order Value Between Groups},
  year   = {2024},
  date   = {2024-06-24},
  url    = {https://flairmi.com/blog/posts/03-t-test.html},
  langid = {en}
}</pre>

<script>
document.querySelectorAll('.copy-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const el = document.querySelector(btn.dataset.target);
    const text = el ? el.innerText : '';
    navigator.clipboard.writeText(text || '');
    const original = btn.textContent;
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = original, 1200);
  });
});
</script>

## Comments

<script src="https://giscus.app/client.js"
        data-repo="MohamedaliS/flairmi"
        data-repo-id=""
        data-category="Blog Comments"
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

```{=html}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Welch t-Test: Comparing Average Order Value Between Groups",
  "description": "Compare average order value between control and treatment groups with a Welch t-test and report the mean difference with a confidence interval and effect size.",
  "datePublished": "2024-06-24",
  "author": {
    "@type": "Person",
    "name": "Mohammed Ali Sharafuddin",
    "url": "https://flairmi.com/about/",
    "affiliation": {"@type": "Organization", "name": "FlairMI", "url": "https://flairmi.com"},
    "identifier": "https://orcid.org/0000-0001-5247-2964"
  },
  "articleSection": "Statistics",
  "about": [
    {"@type":"Thing","name":"t-Test"},
    {"@type":"Thing","name":"A/B Testing"},
    {"@type":"Thing","name":"Revenue Optimization"}
  ],
  "timeRequired": "PT8M"
}
</script>
```
