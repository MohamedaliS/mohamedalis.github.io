---
title: "Confidence Interval for a Proportion: Analyzing Add-to-Cart Rate"
description: "Estimate the add to cart rate with a 95% confidence interval, read the margin of error, and decide if KPIs are acceptable. Runnable R/WebR code."
date: 2024-06-10
lang: en
filters: [webr]
categories: [statistics, A/B testing, conversion optimization, web analytics]
keywords: [confidence interval, margin of error, binomial proportion, ecommerce, A/B testing]
toc: true
number-sections: false
bibliography: ../../assets/refs/references.bib
citation: true
link-citations: true
canonical-url: "https://flairmi.com/blog/posts/01-margin-of-error.html"
format:
  html:
    code-fold: false
    code-tools: false
---

```{=html}
<style>
/* Responsive, wrapped tables and code */
.flair-table-wrap{overflow-x:auto;margin:.75rem 0}
.flair-table{border-collapse:collapse;width:100%;font-size:.95rem;table-layout: fixed; word-wrap: break-word;}
.flair-table th,.flair-table td{border:1px solid #e1e4e8;padding:8px;vertical-align: top;word-break: break-word;}
.flair-table th{background:#f7f7f7;text-align:left}
.flair-table tr:nth-child(even){background:#fafafa}
.flair-caption{font-weight:600;margin:.25rem 0 .5rem 0}
/* Wrap long inline code and pre blocks */
pre, code, pre code { white-space: pre-wrap; word-break: break-word; }
@media (max-width:600px){
  .flair-table td,.flair-table th{padding:6px;font-size:.9rem}
}
/* Small helper for copy buttons */
.copy-row { display:flex; gap:.5rem; margin:.5rem 0; }
.copy-btn { border:1px solid #e1e4e8; background:#f7f7f7; padding:.35rem .6rem; border-radius:6px; cursor:pointer; }
.copy-btn:active { transform: scale(.98); }
</style>
```

TL;DR: Add-to-cart is **22%** (n=600); **95% CI [18.8%, 25.2%]** - **baseline KPI 19% is acceptable**, **stretch 26% isn't**; for ±2 pp precision, target **~1,472-2,401 visitors**.

> Answer  
> Method: Wald confidence interval for a proportion.  
> Estimate: 22% and CI 18.8%, 25.2%.  
> Data: E-commerce traffic, variables add_to_cart, n = 600.  
> Action: Baseline KPI (19%) is met; stretch goal (26%) is not.

## Case

You are a data analyst for an e-commerce site. You observed a **22% add-to-cart rate** over two weeks with **600 visitors**. The business question: Does this performance meet the baseline KPI of 19%? Can you claim the stretch goal of 26%? To answer this, you need to compute a **95% confidence interval** for the add-to-cart proportion, read the **margin of error**, and assess whether the KPIs are acceptable.

## Dataset

Synthetic sample for a single two-week window.

| Variable    | Label               | Value |
|-------------|---------------------|-------|
| `successes` | Add to cart count   | 132   |
| `n`         | Sample size         | 600   |
| `p_hat`     | Observed proportion | 0.22  |

## Method

We use the Wald large-sample CI for a binomial proportion [@Agresti2019]:

$$
\text{MOE} = Z^* \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}.
$$

## Calculation

```{webr-r}
#| label: ci-calculation
#| code-summary: "Click to expand calculation code"

# Standard confidence interval calculation
p_hat <- 0.22
n <- 600

# Compute
se  <- sqrt(p_hat * (1 - p_hat) / n)
z   <- qnorm(0.975)
moe <- z * se
ci  <- p_hat + c(-1, 1) * moe

# Quality checks
succ <- n * p_hat
fail <- n * (1 - p_hat)
rule_ok <- succ >= 10 && fail >= 10
```

```{webr-r}
#| label: results-table
#| results: asis
#| echo: false
#| message: false
#| warning: false

# Minimal HTML table (WebR-friendly)
html_table <- function(df, caption = NULL, class = "flair-table"){
  if (!is.null(caption)) cat(sprintf('<div class="flair-caption">%s</div>', caption))
  head <- paste0("<tr>", paste(sprintf("<th>%s</th>", names(df)), collapse=""), "</tr>")
  rows <- apply(df, 1, function(r) paste0("<tr>", paste(sprintf("<td>%s</td>", r), collapse=""), "</tr>"))
  wrap <- sprintf('<div class="%s-wrap"><table class="%s">%s%s</table></div>',
                  class, class, head, paste(rows, collapse=""))
  cat(wrap)
}

results_table <- data.frame(
  Metric = c("Sample proportion (p̂)", "Standard error", "Margin of error",
             "95% CI lower", "95% CI upper", "Successes", "Failures",
             "Validity check"),
  Value  = c(sprintf("%.3f", p_hat),
             sprintf("%.4f", se),
             sprintf("%.4f (±%.1f%%)", moe, moe*100),
             sprintf("%.3f (%.1f%%)", ci[1], ci[1]*100),
             sprintf("%.3f (%.1f%%)", ci[2], ci[2]*100),
             as.character(round(succ)),
             as.character(round(fail)),
             ifelse(rule_ok, "Passed (n·p̂ ≥ 10 and n·(1−p̂) ≥ 10)", "Warning")),
  stringsAsFactors = FALSE
)
html_table(results_table, caption = "Table 1: Confidence interval calculation results")
```

## Visualization

```{webr-r}
#| label: fig-ci-plot
#| fig-cap: "Figure 1. Confidence interval for add-to-cart proportion with KPI benchmarks."
#| fig-alt: "95% confidence interval for add-to-cart rate with baseline (19%) and stretch (26%) KPI markers."
#| fig-format: png
#| dpi: 150
#| fig-width: 7
#| fig-asp: 0.6
#| out-width: "100%"
#| fig-align: center
#| echo: false
#| warning: false
#| message: false

# Ensure local vars
p_hat <- get0("p_hat", ifnotfound = 0.22)
n     <- get0("n",     ifnotfound = 600)

kpi1 <- 0.19; kpi2 <- 0.26
z  <- qnorm(0.975)
se <- sqrt(p_hat * (1 - p_hat) / n)
moe <- z * se
ci_lower <- p_hat - moe
ci_upper <- p_hat + moe

op <- par(mar = c(5, 4.5, 3.5, 2), xaxs = "i", yaxs = "i", cex = 0.95, family = "sans")
on.exit(par(op), add = TRUE)

plot(NA, xlim = c(0.15, 0.30), ylim = c(0, 1), yaxt = "n",
     xlab = "Add-to-cart proportion", ylab = "",
     main = "95% Confidence Interval with KPI Benchmarks",
     cex.main = 1.05, font.main = 2, cex.lab = 0.95)

rect(ci_lower, 0, ci_upper, 1, col = rgb(0.2, 0.6, 1, 0.12), border = NA)
segments(ci_lower, 0.5, ci_upper, 0.5, lwd = 6, col = "#2C3E50", lend = 2)
points(p_hat, 0.5, pch = 21, cex = 2.1, bg = "#2C3E50", col = "white", lwd = 2)

kpi1_met <- (ci_lower <= kpi1 && kpi1 <= ci_upper)
kpi2_met <- (ci_lower <= kpi2 && kpi2 <= ci_upper)
kpi1_col <- if (kpi1_met) "#27AE60" else "#E74C3C"
kpi2_col <- if (kpi2_met) "#27AE60" else "#E74C3C"

abline(v = kpi1, lty = 2, lwd = 2, col = kpi1_col)
text(kpi1, 0.88, sprintf("Baseline KPI (%.0f%%)", 100 * kpi1), pos = 4, cex = 0.95, col = kpi1_col, font = 2)

abline(v = kpi2, lty = 2, lwd = 2, col = kpi2_col)
text(kpi2, 0.20, sprintf("Stretch KPI (%.0f%%)", 100 * kpi2), pos = 4, cex = 0.95, col = kpi2_col, font = 2)

text(p_hat, 0.72, sprintf("p̂ = %.1f%%", 100 * p_hat), pos = 3, cex = 1.0, font = 2, col = "#2C3E50")
box(col = "#95A5A6", lwd = 1.2)
```

## Results and Interpretation

The estimated add-to-cart proportion was **0.22 (22.0%)** with a 95% confidence interval of **[0.188, 0.252]** (or **[18.8%, 25.2%]**), a margin of error of ±**3.2 percentage points**. The large-sample rule holds (132 successes, 468 failures) [@Agresti2019; @R-base].

**KPI assessment.** Baseline KPI (19%) lies within the CI; stretch KPI (26%) lies above the CI.

**Business decision.** The baseline KPI (19%) is acceptable given the data, suggesting acceptable performance. The stretch KPI (26%) is not supported by this sample - more visitors or performance improvements are needed to claim that goal.

## Sample Size Planning

To achieve ±**2 percentage points** precision at 95% confidence:
$$
n = \hat{p}(1-\hat{p})\left(\frac{Z^*}{\text{MOE}_{\text{target}}}\right)^2.
$$

```{webr-r}
#| label: sample-size-planning
#| results: asis
#| echo: false
#| message: false
#| warning: false

p_hat <- 0.22
moe_target <- 0.02
z <- qnorm(0.975)

n_informed <- ceiling(p_hat * (1 - p_hat) * (z / moe_target)^2)
n_safe <- ceiling(0.25 * (z / moe_target)^2)

sample_size_table <- data.frame(
  Approach = c("Informed (p̂ = 0.22)", "Conservative (p = 0.50)"),
  Required_n = c(format(n_informed, big.mark=","), format(n_safe, big.mark=",")),
  Additional_Visitors = c(format(max(n_informed - 600, 0), big.mark=","), format(max(n_safe - 600, 0), big.mark=",")),
  Use_Case = c("Known conversion rate environment", "New products or uncertain rates"),
  stringsAsFactors = FALSE
)
html_table(sample_size_table, caption = "Table 2: Sample size recommendations for ±2% precision at 95% confidence (Additional_Visitors shows increment beyond current n=600)")
```

## Assumptions

The Wald interval assumes:

- **Independent observations**: Each visitor's cart action is independent (no clustering by session or user ID)
- **Random sampling**: Visitors represent a random sample from the population (not biased toward specific traffic sources or times)
- **Large-sample validity**: Both $n\hat{p} \ge 10$ and $n(1-\hat{p}) \ge 10$ (conditions met: 132 successes and 468 failures both exceed 10)
- **Stable process**: The true conversion rate remains constant during the observation period (no seasonal trends, promotional effects, or A/B tests running concurrently)

---

### Use the below format to cite this page

<div class="copy-row">
  <button class="copy-btn" data-target="#apa-cite">Copy APA</button>
  <button class="copy-btn" data-target="#bibtex-cite">Copy BibTeX</button>
</div>

<pre id="apa-cite">Sharafuddin, M. A. (2024, June 10). Confidence interval for a proportion: Analyzing add-to-cart rate. Flair Marketing Intelligence (FlairMI). https://flairmi.com/blog/posts/01-margin-of-error.html</pre>

<pre id="bibtex-cite">@online{sharafuddin2024-ci-proportion,
  author = {Sharafuddin, Mohammed Ali},
  title  = {Confidence Interval for a Proportion: Analyzing Add-to-Cart Rate},
  year   = {2024},
  date   = {2024-06-10},
  url    = {https://flairmi.com/blog/posts/01-margin-of-error.html},
  langid = {en}
}</pre>

<script>
document.querySelectorAll('.copy-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const el = document.querySelector(btn.dataset.target);
    const text = el ? el.innerText : '';
    navigator.clipboard.writeText(text || '');
    const original = btn.textContent;
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = original, 1200);
  });
});
</script>

## Comments

<script src="https://giscus.app/client.js"
        data-repo="MohamedaliS/flairmi"
        data-repo-id=""
        data-category="Blog Comments"
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

```{=html}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Confidence Interval for a Proportion: Analyzing Add-to-Cart Rate",
  "description": "Estimate the add-to-cart rate with a 95% confidence interval, read the margin of error, and decide if KPIs are acceptable. Runnable R/WebR code.",
  "datePublished": "2024-06-10",
  "author": {
    "@type": "Person",
    "name": "Mohammed Ali Sharafuddin",
    "url": "https://flairmi.com/about/",
    "affiliation": {"@type": "Organization", "name": "FlairMI", "url": "https://flairmi.com"},
    "identifier": "https://orcid.org/0000-0001-5247-2964"
  },
  "articleSection": "Statistics",
  "about": [
    {"@type":"Thing","name":"Confidence Interval"},
    {"@type":"Thing","name":"A/B Testing"},
    {"@type":"Thing","name":"Conversion Rate Optimization"}
  ],
  "timeRequired": "PT8M"
}
</script>
```